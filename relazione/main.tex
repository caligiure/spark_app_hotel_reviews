\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[italian]{babel}
\usepackage{geometry}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{color}
\usepackage{graphicx}

\geometry{a4paper, margin=2.5cm}

\title{\textbf{Relazione Big Data \\
                Progetto n. 9: Hotel Reviews}}
\author{Giuseppe Pasquale Caligiure - Mat. 280867}
\date{Febbraio 2026}

\begin{document}

\maketitle
\tableofcontents
\newpage

\section{Presentazione del Progetto} 

\subsection{Contesto di lavoro e obiettivi Realizzati}
Il presente progetto è stato realizzato lavorando sul dataset ``Hotel Reviews'', contenente oltre 515.000 recensioni di alberghi di lusso europei. L'applicativo realizzato consente di effettuare interrogazioni aggregate sul dataset, con l'obiettivo di estrarre insight significativi dai dati.
Sfruttando le potenzialità di elaborazione distribuita offerte dal framework Spark, sono stati realizzati diversi moduli di analisi che consentono di rilevare aspetti temporali, testuali, geospaziali e comportamentali nelle recensioni del dataset. Gli obiettivi principali raggiunti includono:
\begin{itemize}
    \item Identificazione dei trend di gradimento degli hotel nel tempo.
    \item Analisi dell'influenza di specifici tag (caratteristiche del soggiorno) sul punteggio finale.
    \item Segmentazione geografica e analisi della competitività locale.
    \item Profilazione degli hotel tramite algoritmi di Machine Learning (Clustering).
    \item Studio delle preferenze in base alla nazionalità e tipologia di viaggiatore.
\end{itemize}
 % -------------------------------------
\subsection{Architettura Frontend/Backend}
L'applicazione è stata realizzata seguendo una logica Frontend/Backend:
\begin{itemize}
    \item \textbf{Backend (Spark)}: Il file \texttt{queries.py} contiene la logica di lavoro. Ogni funzione implementa una diversa analisi dei dati, ma tutte rispettano il seguente schema: accetta un DataFrame Spark in input e restituisce un DataFrame Spark trasformato con i risultati.
    \item \textbf{Frontend (Streamlit)}: Il file \texttt{app.py} gestisce l'interfaccia utente. All'avvio inizializza una \texttt{SparkSession} (cachata per efficienza) e carica il dataset. Quando l'utente seleziona un'analisi, il frontend invoca la funzione corrispondente dal backend, converte i risultati aggregati (di dimensioni ridotte) in Pandas DataFrame e li visualizza tramite grafici e tabelle.
\end{itemize}
 % -------------------------------------
\subsection{Tecnologie Utilizzate e Requisti}
Il progetto è stato sviluppato in Python, utilizzando il framework di Spark per eseguire interrogazioni in maniera scalabile e distribuita. 
\begin{itemize}
    \item \textbf{Linguaggio}: Python 3.11. (il progetto è stato testato con Python 3.11.9)
    \item \textbf{Backend:} \textbf{Apache Spark} (PySpark) per l'elaborazione parallela e distribuita dei dati. In particolare sono stati utilizzati DataFrame Spark, Spark SQL, Window Functions e User Defined Functions (UDF).
    \item \textbf{Machine Learning}: \textbf{Spark MLlib} per operazioni di clustering (K-Means) e \textbf{Scikit-learn} per regressioni lineari all'interno di UDF pandas.
    \item \textbf{Frontend}: \textbf{Streamlit} per la creazione di una web-app interattiva che permette all'utente di eseguire query e filtrare risultati.
    \item \textbf{Visualizzazione}: \textbf{Altair}, \textbf{PyDeck} e \textbf{Pandas} per la creazione di grafici interattivi e mappe geospaziali.
    \item \textbf{Gestione Dipendenze Windows}: Winutils e Hadoop per l'esecuzione locale su ambiente Windows.
\end{itemize}
 % -------------------------------------
\subsection{Logica di Funzionamento}
\begin{enumerate}
    \item L'utente avvia l'applicazione tramite script batch (\texttt{RUN\_APP\_Hotel\_Reviews.bat}) o comando Streamlit (\texttt{python -m streamlit run app.py}).
    \item L'app si avvia automaticamente in una finestra del browser predefinito del dispositivo in uso, ma è anche raggiungibile da altri dispositivi (pc, tablet, smartphone) collegati sulla stessa rete locale, tramite gli indirizzi specificati nel terminale (Figura \ref{fig:indirizzi}).
    \begin{figure}[h]
        \centering
        \includegraphics[width=0.5\linewidth]{imgs/indirizzi.png}
        \caption{URL della web-app}
        \label{fig:indirizzi}
    \end{figure}
    \item Dopo il caricamento iniziale del dataset in memoria (DataFrame Spark), tramite una sidebar laterale è possibile selezionare una delle query disponibili.
    \item Ogni query espone parametri specifici (es. numero minimo di recensioni, raggio in km) modificabili tramite slider o input box. L'esecuzione della query avviene on-demand sfruttando il motore Spark. I risultati vengono visualizzati in-app tramite grafici, tabelle e mappe interattive.
\end{enumerate}
 % -------------------------------------
\section{Descrizione del Dataset Hotel\_Reviews}
Il dataset utilizzato è \texttt{Hotel\_Reviews.csv} (reperibile su: \url{https://www.kaggle.com/datasets/jiashenliu/515k-hotel-reviews-data-in-europe}. Questo archivio contiene oltre 515.000 recensioni di hotel di lusso in Europa, raccolte dal sito Booking.com, dove sono pubblicamente accessibili. Ogni riga del dataset corrisponde ad una recensione e presenta 17 campi che descrivono sia le caratteristiche dell'hotel, sia l'esperienza del cliente.

\begin{itemize}
    \item \textbf{Dimensione File}: Circa 238 MB
    \item \textbf{Numero di Righe}: 515.738
\end{itemize}
 % -------------------------------------
\subsection{Campi del Dataset}
\begin{itemize}
    \item \texttt{Hotel\_Address}: Indirizzo dell'hotel.
    \item \texttt{Additional\_Number\_of\_Scoring}: Numero di valutazioni aggiuntive (clienti che hanno lasciato solo una valutazione numerica dell'hotel, senza recensione).
    \item \texttt{Review\_Date}: Data in cui è stata rilasciata la recensione.
    \item \texttt{Average\_Score}: Punteggio medio storico dell'hotel (calcolato su tutte le recensioni ricevute dall'hotel nell'ultimo anno).
    \item \texttt{Hotel\_Name}: Nome della struttura.
    \item \texttt{Reviewer\_Nationality}: Nazionalità dell'utente che ha lasciato la recensione.
    \item \texttt{Negative\_Review}: Testo del commento negativo ("No Negative" se assente).
    \item \texttt{Review\_Total\_Negative\_Word\_Counts}: Conteggio parole commento negativo.
    \item \texttt{Total\_Number\_of\_Reviews}: Totale recensioni ricevute dall'hotel.
    \item \texttt{Positive\_Review}: Testo del commento positivo ("No Positive" se assente).
    \item \texttt{Review\_Total\_Positive\_Word\_Counts}: Conteggio parole commento positivo.
    \item \texttt{Total\_Number\_of\_Reviews\_Reviewer\_Has\_Given}: Numero di recensioni rilasciate dell'utente in passato.
    \item \texttt{Reviewer\_Score}: Voto assegnato dal recensore all'hotel.
    \item \texttt{Tags}: Lista di stringhe che descrivono il soggiorno (es. "Leisure trip", "Couple", "Stayed 2 nights").
    \item \texttt{days\_since\_review}: Giorni trascorsi fra la pubblicazione e lo scraping della recensione.
    \item \texttt{lat}: Latitudine dell'hotel.
    \item \texttt{lng}: Longitudine dell'hotel.
\end{itemize}
 % -------------------------------------
\section{Descrizione delle Query Implementate}

\subsection{Trend Recensioni (Time Series)}

\paragraph{Obiettivo:} Analizzare il \textbf{trend temporale} dei punteggi degli hotel (utilizzando la Regressione Lineare) per identificare quali alberghi stanno migliorando o peggiorando nel tempo.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/trend.png}
    \caption{Query Trend Recensioni (Time Series)}
    \label{fig:trend}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Le recensioni vengono \textbf{raggruppate per hotel} e ordinate cronologicamente.
    \item Per ogni gruppo (stesso hotel): da ogni recensione si estraggono i valori di \texttt{Reviewer\_Score} e \texttt{Review\_Date} (convertita in ordinale), quindi viene applicata una \textbf{regressione lineare (score vs tempo)} per calcolare la pendenza (\textbf{slope}) del \textbf{trend}. Inoltre, si effettua il calcolo di \textbf{altri valori aggregati}: punteggio medio, numero di recensioni, data della prima recensione, data dell'ultima recensione.
    \item Viene restituito un dataframe contenente i risultati ottenuti per ogni hotel.
\end{itemize}

\paragraph{Tecnologie:} Viene definita una Pandas UDF (User Defined Function) per l'esecuzione della regressione lineare con \texttt{scikit-learn}. La UDF viene eseguita con la funzione \texttt{applyInPandas} affinché questa operazione sia parallelizzabile su ogni gruppo di hotel distribuito nei nodi Spark.

\paragraph{Risultati:} Viene visualizzata la lista dei \textbf{Top 10 Hotel in Crescita} e dei \textbf{Top 10 Hotel in Calo}, ordinati per trend slope (Figura \ref{fig:trend2}), dove trend positivo indica miglioramento, mentre trend negativo indica peggioramento. Inoltre, viene visualizzato il grafico \textbf{Distribuzione Trend vs Punteggio Medio} (Figura \ref{fig:trend3}) che consente di individuare visivamente gli alberghi migliori o peggiori e leggerne le caratteristiche.

\paragraph{Casi d'uso:} Identificare "\textbf{stelle nascenti}" o \textbf{hotel decadenti} nonostante un alto punteggio medio storico.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/trend2.png}
    \caption{Top 10 Hotel in Crescita/Calo}
    \label{fig:trend2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/trend3.png}
    \caption{Distribuzione Trend vs Punteggio Medio}
    \label{fig:trend3}
\end{figure}
\clearpage
 % -------------------------------------
\subsection{Analisi Influenza Tag}

\paragraph{Obiettivo:} Determinare quali fattori (es. "Single Room", "No Window") impattano positivamente o negativamente sul punteggio che i recensori assegnano agli hotel.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tag.png}
    \caption{Query Analisi Influenza Tag}
    \label{fig:tag}
\end{figure}

\paragraph{Logica Backend:} 
\begin{itemize}
    \item Le recensioni vengono "esplose": si prende in input la stringa dei tag di ogni recensione, la stringa viene suddivisa in singoli tag, ciascuno dei quali viene poi "ripulito" da eventuali spazi vuoti o lettere maiuscole, e infine si produce in output una riga per ogni singolo tag letto in input (gli altri campi della riga vengono duplicati dalla recensione originale da cui è stato estratto il tag).
    \item Le righe risultanti vengono raggruppate per tag, eseguendo delle operazioni di \textbf{aggregazione} sugli hotel associati ad ogni tag: conteggio del numero di hotel, calcolo del punteggio medio degli hotel e calcolo della \textbf{deviazione standard} (ad esempio, se la deviazione standard è alta, significa che i voti sono molto dispersi, quindi la valutazione del peso di quel tag sarà meno affidabile).
    \item Viene calcolata la \textbf{media globale} sui punteggi medi di tutti i tag, per poter avere un indice di confronto sulla base del quale valutare se un tag ha un \textbf{impatto} positivo o negativo rispetto agli altri (ad esempio, se un tag ha una media di 9.0 e la media globale è 8.5, allora quel tag ha un "impatto positivo" (+0.5)).
    \item Per ogni tag, vengono calcolati: \\
    \texttt{Impact = Average\_Score - Global\_Average} \\
    \texttt{Reliability\_Index = (1 / (StdDev + 0.1)) * log(Count)} \\
    \texttt{Weighted\_Impact = Impact * Reliability\_Index} \\
    Il \texttt{Reliability\_Index} è un indice euristico che valuta quanto è attendibile l'impatto di un tag, premiando i tag con una maggiore stabilità dei voti (deviazione standard bassa) e con un'alta frequenza (il logaritmo serve per mitigare l'impatto dei tag estremamente frequenti).
    \item Viene restituito un dataframe contenente i risultati ottenuti per ogni tag.
\end{itemize}

\paragraph{Risultati:} Vengono visualizzate le classifiche dei \textbf{tag con il maggior impatto positivo e negativo} (Figura \ref{fig:tag2}), ordinati per \texttt{Weighted\_Impact} decrescente/crescente. Inoltre, viene visualizzato il grafico \textbf{Affidabilità vs Impatto} (Figura \ref{fig:tag3}), che consente di individuare i fattori che influenzano maggiormente (in positivo o in negativo) la valutazione degli hotel e valutare a colpo d'occhio il grado di attendibilità di ciascuno di essi.

\paragraph{Casi d'uso:} Identificare le \textbf{caratteristiche più apprezzate o criticate} dai clienti degli hotel.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tag2.png}
    \caption{Top 10 Tag Positivi/Negativi}
    \label{fig:tag2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tag3.png}
    \caption{Grafico Affidabilità vs Impatto}
    \label{fig:tag3}
\end{figure}
\clearpage
 % -------------------------------------
\subsection{Analisi Bias Nazionalità}

\paragraph{Obiettivo:} Individuare, se esistono, le nazionalità che tendono a dare voti più alti o bassi rispetto alla media.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/bias.png}
    \caption{Query Analisi Bias Nazionalità}
    \label{fig:bias}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Raggruppamento delle recensioni per \texttt{Reviewer\_Nationality}.
    \item Calcolo di valori aggregati per ogni nazionalità: numero di recensioni, media dei punteggi assegnati nelle recensioni, media del numero di parole positive scritte nelle recensioni, media del numero di parole negative scritte nelle recensioni.
    \item Calcolo della \textbf{media globale} di tutti i punteggi assegnati in tutte le recensioni (da utilizzare per confronto).
    \item Calcolo dello \texttt{Score\_Deviation} di ogni nazionalità, cioè la differenza fra la media dei punteggi assegnati da recensori di quella nazionalità e la media globale. Questa metrica indica se mediamente i recensori di una certa nazionalità sono più \textbf{critici (deviazione negativa)} o \textbf{generosi (deviazione positiva)} nell'assegnare le valutazioni degli hotel.
    \item Calcolo del \texttt{Sentiment\_Ratio} di ogni nazionalità, cioè il rapporto fra numero di parole positive e negative utilizzate nelle recensioni. Questa metrica, quando considerata in relazione con il punteggio medio assegnato dai recensori di una certa nazionalità, indica la \textbf{coerenza} di questi recensori: chi dà più spesso valutazioni numeriche positive dovrebbe avere un \texttt{Sentiment\_Ratio} positivo (cioè dovrebbe utilizzare mediamente più parole positive che negative), mentre chi è più critico e dà più spesso valutazioni numeriche negative dovrebbe avere un \texttt{Sentiment\_Ratio} negativo.
    \item Restituzione del dataset aggregato per \texttt{Reviewer\_Nationality}, con le metriche calcolate.
\end{itemize}

\paragraph{Risultati:} Vengono visualizzate le classifiche delle \textbf{nazionalità più critiche e più generose} (Figura \ref{fig:bias2}), ordinate per \texttt{Score\_Deviation} crescente/decrescente. Inoltre, viene visualizzato il grafico \textbf{Correlazione Voto vs Positività Testo} (Figura \ref{fig:bias3}), che consente di valutare visivamente la coerenza dei recensori per ogni nazionalità.

\paragraph{Casi d'uso:} Profilazione per nazionalità e identificazione di bias culturali che peggiorano o migliorano l'esperienza dei clienti.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/bias2.png}
    \caption{Classifica nazionalità più critiche e più generose}
    \label{fig:bias2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/bias3.png}
    \caption{Grafico Correlazione Voto vs Positività Testo}
    \label{fig:bias3}
\end{figure}
\clearpage
 % -------------------------------------
\subsection{Analisi Competitività Locale}

\paragraph{Obiettivo:} Confrontare le performance di un hotel rispetto ai suoi concorrenti geograficamente più vicini.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/local.png}
    \caption{Query Analisi Competitività Locale}
    \label{fig:local}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Esegue un \textbf{self-join} del dataset per calcolare tutte le possibili coppie di hotel distinti: \texttt{Hotel\_A} e \texttt{Hotel\_B}.
    \item Calcola la \textbf{distanza geografica fra ogni coppia di hotel} (utilizzando la Formula di Haversine).
    \item Filtra le coppie di hotel, mantenendo solo quelle che hanno una distanza inferiore a N chilometri (N è un parametro scelto dall'utente).
    \item Raggruppa per \texttt{Hotel\_A}, ottenendo per ogni hotel il suo vicinato. Poi aggrega i campi degli hotel appartenenti al vicinato, calcolando \textbf{punteggio medio del vicinato} e \textbf{numero di concorrenti}. Infine, calcola \texttt{Score\_Delta =} differenza fra il punteggio di \texttt{Hotel\_A} e la media del vicinato.
    \item Classifica come \textbf{Outperformer} gli hotel con \texttt{Score\_Delta > 0} e come \textbf{Underperformer} quelli con \texttt{Score\_Delta < 0}. Infine, restituisce il dataset con i valori aggregati appena calcolati.
\end{itemize}

\paragraph{Risultati:} Vengono visualizzate le classifiche delle \textbf{Gemme Locali (i migliori Outperformer)} e dei \textbf{peggiori Underperformer} (Figura \ref{fig:local2}), ordinate per \texttt{Score\_Delta} decrescente/crescente. Inoltre, viene visualizzato il grafico \textbf{Performance Relativa} (Figura \ref{fig:local3}), che consente di individuare visivamente gli hotel che appartengono all'una o all'altra categoria, confrontando il voto dell'hotel con il voto medio del suo vicinato.

\paragraph{Casi d'uso:} Analisi della competitività fra attività geograficamente vicine.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/local2.png}
    \caption{Classifica migliori Outperformer e peggiori Underperformer}
    \label{fig:local2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/local3.png}
    \caption{Grafico Performance Relativa}
    \label{fig:local3}
\end{figure}
\clearpage

% -------------------------------------
\subsection{Segmentazione Hotel (K-Means Clustering)}
\paragraph{Obiettivo:} Raggruppare gli hotel in cluster omogenei (utilizzando K-Means Clustering), sulla base delle seguenti feature: Punteggio Medio, Popolarità (numero recensioni), Verbosità delle recensioni, Posizione geografica, Bias di nazionalità. L'utente seleziona fra queste le caratteristiche sulla base delle quali saranno raggruppati gli hotel. Inoltre, può scegliere il numero di gruppi in cui effettuare la suddivisione.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/kmeans.png}
    \caption{Query Segmentazione Hotel (K-Means Clustering)}
    \label{fig:kmeans}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Raggruppamento per hotel e aggregazione per il calcolo delle feature.
    \item Creazione di vettore delle feature con VectorAssembler e normalizzazione con StandardScaler.
    \item Clustering degli hotel con algoritmo K-Means. 
\end{itemize}

\paragraph{Tecnologie:} \texttt{Da Spark MLlib}: VectorAssembler, StandardScaler, KMeans, Pipeline).

\paragraph{Risultati:} Assegnazione di ogni hotel a un cluster (es. "Hotel Popolari di Lusso", "Hotel Economici di Nicchia").
\begin{itemize}
    \item Analisi delle caratteristiche di ogni cluster (Figura \ref{fig:kmeans2}).
    \item Mappa interattiva della distribuzione geografica dei cluster (Figura \ref{fig:kmeans3}).
    \item Grafico interattivo per l'esplorazione delle performance dei cluster, con possibilità di confrontare: Punteggio medio, Numero di recensioni, Numero medio di parole positive nelle recensioni, Numero medio di parole negative nelle recensioni (Figura \ref{fig:kmeans4}).
    \item Grafico della distribuzione delle nazionalità dei cluster (Figura \ref{fig:kmeans5}).
\end{itemize}

\paragraph{Casi d'uso:} Segmentazione di marketing, raccomandazioni di hotel simili.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/kmeans2.png}
    \caption{Analisi delle caratteristiche di ogni cluster}
    \label{fig:kmeans2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/kmeans3.png}
    \caption{Mappa interattiva della distribuzione geografica dei cluster}
    \label{fig:kmeans3}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/kmeans4.png}
    \caption{Grafico interattivo per l'esplorazione delle performance dei cluster}
    \label{fig:kmeans4}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/kmeans5.png}
    \caption{Grafico della distribuzione delle nazionalità dei cluster}
    \label{fig:kmeans5}
\end{figure}
\clearpage
% -------------------------------------
\subsection{Migliori Hotel per Nazione}

\paragraph{Obiettivo:} Identificare le eccellenze alberghiere suddivise per paese.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/top.png}
    \caption{Query Migliori Hotel per Nazione}
    \label{fig:top}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Deduplicazione degli hotel nelle recensioni.
    \item Estrazione della nazione dall'indirizzo dell'hotel.
    \item Raggruppamento delle strutture per nazione e ordinamento in base al punteggio medio e al numero di recensioni (in caso di parità).
\end{itemize}

\paragraph{Risultati:} Viene visualizzata la lista dei top N hotel per ogni nazione presente nel dataset (le nazioni sono presentate in ordine alfabetico) e la distribuzione dei punteggi dei migliori hotel in assoluto (Figura \ref{fig:top2}). Inoltre, viene visualizzata la mappa geografica che mostra dove si trovano gli hotel (Figura \ref{fig:top3}).
\paragraph{Casi d'uso:} Utenti che cercano i migliori hotel in una specifica destinazione turistica.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/top2.png}
    \caption{Top N Hotel per Nazione e Distribuzione dei Punteggi degli Hotel}
    \label{fig:top2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/top3.png}
    \caption{Mappa dei Migliori Hotel}
    \label{fig:top3}
\end{figure}
\clearpage
% -------------------------------------
\subsection{Locals vs Tourists - Preferenze e distribuzione clienti}

\paragraph{Obiettivo:} Analizzare la differenza di percezione tra chi visita il proprio paese (Local) e chi viene dall'estero (Tourist).
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tour.png}
    \caption{Query Locals vs Tourists - Preferenze e distribuzione clienti}
    \label{fig:tour}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Estrazione della nazione dall'indirizzo dell'hotel e della nazionalità del recensore, poi classificazione fra Local (stessa nazione) e Tourist.
    \item Raggruppamento per hotel e nazione, poi pivot su tipologia di recensore (Local o Tourist) e infine calcolo di valori aggregati: \texttt{Local\_Avg\_Score}, \texttt{Tourist\_Avg\_Score} e differenza fra i due valori (\texttt{Preference\_Delta}).
    \item Calcolo della percentuale di recensioni proveniente da ogni gruppo nazionale per ogni hotel:
    \begin{itemize}
        \item Aggregazione per hotel e calcolo numero totale di recensioni.
        \item Aggregazione per hotel e nazionalità recensore per calcolo numero di recensioni da recensori con stessa nazionalità.
        \item Calcolo percentuale di recensioni di ogni nazionalità rispetto al totale delle recensioni, per ogni hotel.
    \end{itemize}
\end{itemize}

\paragraph{Risultati:}
\begin{itemize}
    \item Liste degli hotel preferiti dai locali (\texttt{Preference\_Delta} positivo) e degli hotel preferiti dai turisti (\texttt{Preference\_Delta} negativo), ordinati per \texttt{Preference\_Delta}, in modo da visualizzare per primi gli hotel che hanno le maggiori discrepanze di voto (Figura \ref{fig:tour2}).
    \item Grafico Discrepanza Voti per individuare visivamente la distribuzione degli hotel in relazione alla tipologia di clientela che li apprezza di più o di meno (Figura \ref{fig:tour3}).
    \item Grafico Distribuzione Nazionalità per visualizzare la composizione percentuale delle nazionalità dei visitatori degli Hotel (Figura \ref{fig:tour4}).
\end{itemize}

\paragraph{Casi d'uso:} Identificazione di "Trappole per turisti" o "Preferiti dai locali" (hotel che potrebbero offrire un'esperienza più autentica).
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tour2.png}
    \caption{Liste degli hotel preferiti dai locali e degli hotel preferiti dai turisti}
    \label{fig:tour2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tour3.png}
    \caption{Grafico Discrepanza Voti}
    \label{fig:tour3}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/tour4.png}
    \caption{Grafico Distribuzione Nazionalità}
    \label{fig:tour4}
\end{figure}
\clearpage
% -------------------------------------
\subsection{Analisi Stagionale \& Target}

\paragraph{Obiettivo:} Analizzare come varia il gradimento in base alla stagione e al tipo di viaggio (Leisure/Business/Solo/Family/Group/Couple).
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/stag.png}
    \caption{Query Analisi Stagionale \& Target}
    \label{fig:stag}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Estrazione \textbf{mese} dalla data della recensione.
    \item Estrazione \textbf{tipologia di viaggiatore} analizzando i tag della recensione: poichè una recensione potrebbe appartenere a più tipi contemporaneamente (es. Solo e Business, Group e Leisure), si applica la seguente logica:
    \begin{itemize}
        \item si estrae tutta la lista dei tag e si filtrano solo quelli utili
        \item per ogni tag si genera una nuova riga in cui il campo \texttt{Traveler\_Type} assume il valore di quel tag (i valori degli altri campi vengono duplicati dalla riga originale).
    \end{itemize}
    \item \textbf{Aggregazione} per Hotel, Stagione e Tipologia di Viaggiatore, calcolando punteggio medio e numero di recensioni.
\end{itemize}

\paragraph{Risultati:}
\begin{itemize}
    \item Lista degli hotel migliori in base alle stagioni e alle tipologie di viaggio selezionate, ordinati per punteggio medio (Figura \ref{fig:stag2}).
    \item Heatmap Stagionale Hotel per visualizzare dettagliatamente le performance di un hotel in ogni possibile combinazione di stagione e tipologia di viaggio (Figura \ref{fig:stag3}).
    \item Mappa interattiva che mostra la posizione geografica dei migliori hotel corrispondenti ai criteri della ricerca (Figura \ref{fig:stag4}).
\end{itemize}

\paragraph{Casi d'uso:} Analisi delle Performance degli hotel in specifiche stagioni (es. hotel ottimi per l'estate ma carenti in inverno), analisi dell'apprezzamento degli hotel da parte di specifiche tipologie di viaggiatori, pianificazione di viaggi in base alle esigenze dell'utente.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/stag2.png}
    \caption{Lista degli hotel migliori in base alle stagioni e alle tipologie di viaggio selezionate}
    \label{fig:stag2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/stag3.png}
    \caption{Heatmap Stagionale Hotel}
    \label{fig:stag3}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/stag4.png}
    \caption{Mappa migliori hotel corrispondenti ai criteri della ricerca}
    \label{fig:stag4}
\end{figure}
\clearpage
% -------------------------------------
\subsection{Analisi Durata Soggiorno}

\paragraph{Obiettivo:} Analizzare la correlazione tra la durata del soggiorno (numero di notti) e il livello di soddisfazione dei clienti.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/sog.png}
    \caption{Query Analisi Durata Soggiorno}
    \label{fig:sog}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Logica per l'estrazione del numero di notti dai tag delle recensioni:
    \begin{itemize}
        \item input: tutte le recensioni, output: esplosione del dataset, producendo in output una riga per ogni elemento della lista dei tag di ogni recensione,
        \item filtraggio di tutte le righe che presentano un tag nella forma "Stayed X nights",
        \item estrazione del numero di notti (X),
        \item categorizzazione del soggiorno fra: Short (1-3), Medium (4-7), Long (8+).
    \end{itemize}
    \item Raggruppamento delle recensioni risultanti per hotel e categoria di soggiorno, con calcolo dei seguenti valori aggregati: punteggio medio, conteggio recensioni, durata media dei soggiorni.
\end{itemize}

\paragraph{Risultati:}
\begin{itemize}
    \item Viene analizzato lo \texttt{Score\_Delta} delle diverse categorie di soggiorno, che è un \textbf{indicatore globale delle performance} di ogni categoria (Figura \ref{fig:sog2}). Lo \texttt{Score\_Delta} indica quanto il punteggio medio di ogni categoria di recensioni si discosta dalla media globale: ad esempio, se le recensioni di categoria "Long Stay" hanno un \textbf{delta negativo}, significa che, mediamente, i clienti che soggiornano a lungo negli hotel sono più \textbf{insoddisfatti} rispetto al gradimento medio globale.
    \item Vengono visualizzate le classifiche dei migliori hotel per ogni categoria di soggiorno, ordinate per punteggio medio (Figura \ref{fig:sog3}).
    \item Viene visualizzato un grafico della distribuzione degli hotel in relazione alla durata media dei soggiorni dei loro clienti e al loro punteggio medio (Figura \ref{fig:sog4}). Da questa rappresentazione è possibile valutare quali sono le durate dei soggiorni più frequenti e come sono correlate con la soddisfazione dei clienti.
\end{itemize}

\paragraph{Casi d'uso:} Ottimizzazione delle offerte per soggiorni lunghi e corti, grazie a statistiche che mostrano se i soggiorni lunghi tendono ad avere recensioni peggiori o migliori.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/sog2.png}
    \caption{Performance Globale (Scostamento dalla Media)}
    \label{fig:sog2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/sog3.png}
    \caption{Classifiche dei migliori hotel per ogni categoria di soggiorno}
    \label{fig:sog3}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/sog4.png}
    \caption{Grafico distribuzione hotel: punteggio medio vs durata soggiorno}
    \label{fig:sog4}
\end{figure}
\clearpage
% -------------------------------------
\subsection{Analisi Esperienza Recensore}

\paragraph{Obiettivo:} Valutare se il punteggio delle recensioni degli hotel cambia in base all'esperienza dei recensori (ad esempio se i recensori esperti sono più critici dei novizi).
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/esp.png}
    \caption{Query Analisi Esperienza Recensore}
    \label{fig:esp}
\end{figure}

\paragraph{Logica Backend:}
\begin{itemize}
    \item Categorizzazione recensioni in base all'esperienza del recensore, cioè in base al campo \texttt{Total\_Number\_of\_Reviews\_Reviewer\_Has\_Given}: se ha scritto meno di 5 recensioni allora è un "\textbf{Novizio}", se ha scritto fra 5 e 25 recensioni allora è un "\textbf{Intermedio}", altrimenti è un "\textbf{Esperto}".
    \item Aggregazione (con pivot su \texttt{Experience\_Level}), raggruppando per Hotel e livello di esperienza del recensore, calcolando punteggio medio e numero di recensioni.
    \item Calcolo dell'\texttt{Experience\_Gap} per ogni hotel, cioè la differenza tra il voto medio ottenuto dalle recensioni degli esperti e il voto medio ottenuto dalle recensioni dei novizi.
\end{itemize}

\paragraph{Risultati:}
\begin{itemize}
    \item Viene visualizzato il \textbf{Gap Medio} (Figura \ref{fig:esp2}), cioè la differenza fra il voto medio assegnato dagli esperti e il voto medio assegnato dai novizi, calcolato su tutte le recensioni. Questo valore è la \textbf{metrica di riferimento} per valutare quanto in media i recensori esperti sono più critici dei novizi, o viceversa. Inoltre, vengono visualizzate le classifiche degli hotel con la maggior discrepanza (\texttt{Experience\_Gap}) fra la valutazione degli esperti e quella dei novizi, sia in negativo (hotel criticati dagli esperti e apprezzati dai novizi), sia in positivo (hotel apprezzati dagli esperti e criticati dai novizi). Con questi confronti è possibile valutare quanto in media l'esperienza dei recensori impatta sulla valutazione degli hotel e quanto sono concordi o discordi le opinioni di recensori con diversi livelli di esperienza.
    \item Viene visualizzato un grafico della distribuzione degli hotel in relazione al voto ottenuto dai novizi e dagli esperti (Figura \ref{fig:esp3}), che consente di valutare visivamente quanto sono frequenti gli hotel con alta o bassa discrepanza di voti.
\end{itemize}

\paragraph{Casi d'uso:} Analisi della severità del voto in base dell'esperienza, in funzione di una ponderazione del peso delle recensioni in un sistema di ranking avanzato.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/esp2.png}
    \caption{Gap Medio e classifiche degli hotel con la maggior discrepanza (\texttt{Experience\_Gap})}
    \label{fig:esp2}
\end{figure}
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/esp3.png}
    \caption{Grafico Novizi vs Esperti}
    \label{fig:esp3}
\end{figure}
\clearpage
 % -------------------------------------
\section{Conclusioni Finali}

Il progetto dimostra come l'utilizzo di \textbf{Spark} permetta di effettuare analisi complesse su un dataset di grandi dimensioni con \textbf{tempi di risposta contenuti}. L'architettura implementata garantisce \textbf{scalabilità orizzontale}, potendo gestire volumi di dati ben superiori a quello attuale senza modifiche al codice.
\subsection{User Interface}
L'\textbf{interfaccia grafica} realizzata con \textbf{Streamlit} offre un'esperienza utente semplice e funzionale, consentendo di eseguire le query on-demand e visualizzarne i risultati con facilità. Inoltre, l'utilizzo del sistema \textbf{web-app} rende il frontend dell'applicazione compatibile con diverse tipologie di dispositivo (Figura \ref{fig:smartphone}) senza richiedere l'installazione di alcun software e la rende accessibile da molteplici dispositivi contemporaneamente.
\begin{figure}[ht]
    \centering
    \includegraphics[width=0.9\linewidth]{imgs/smartphone.png}
    \caption{Esempi di come appare la UI della web-app quando vi si accede da smartphone (Android)}
    \label{fig:smartphone}
\end{figure}
\subsection{Analisi dei dati}
Le query implementate esplorano diversi metodi di analisi dei dati, fra cui:
\begin{itemize}
    \item \textbf{Analisi Descrittiva:} sintetizzare e riassumere i dati storici per descriverne le caratteristiche principali, utilizzando metriche chiave come media e deviazione standard, che offrono un'istantanea della distribuzione e delle tendenze centrali dei dati.
    \item \textbf{Analisi Diagnostica:} confrontare i dati, scoprire relazioni tra diverse informazioni (analisi di \textbf{correlazione}) e capire l'impatto di un fattore sull'altro (analisi di \textbf{regressione}), in modo da identificare le cause reali dei fenomeni osservati.
    \item \textbf{Analisi Predittiva:} prevedere risultati (\textbf{clustering/trend}), basandosi sull'uso di algoritmi che imparano dagli schemi presenti nei dati passati per proiettarli nel futuro.
\end{itemize}
\subsection{Possibili Sviluppi Futuri}
\begin{itemize}
    \item \textbf{Analisi Prescrittiva:} raccomandare le azioni ottimali da intraprendere per raggiungere un risultato desiderato, utilizzando sistemi avanzati che simulano diversi scenari e valutano le opzioni migliori.
    \item \textbf{Analisi Inferenziale:} fare previsioni o generalizzazioni su una popolazione più ampia basandosi sull'analisi del campione di dati (test di ipotesi, intervalli di confidenza).
    \item \textbf{Analisi del Testo Avanzata}: implementare modelli NLP per Sentiment Analysis sulle recensioni testuali.
    \item \textbf{Streaming}: integrare Spark Streaming per elaborare recensioni in tempo reale.
    \item \textbf{Recommendation System}: sviluppare un sistema di raccomandazione basato sulla similarità utente-utente.
\end{itemize}

\end{document}
